/*! communist 2013-05-22*/
/*!©2013 Calvin Metcalf @license MIT https://github.com/calvinmetcalf/communist */
/*!Includes Promiscuous ©2013 Ruben Verborgh @license MIT https://github.com/RubenVerborgh/promiscuous*/
"undefined"==typeof document?(self._noTransferable=!0,self.onmessage=function(e){eval(e.data)}):function(){"use strict";function n(n){var e,t=n.match(/(importScripts\(.*\);)/);return e=t?t[0].replace(/importScripts\((.*\.js\')\);?/,function(n,e){return e?"importScripts("+e.split(",").map(function(n){return"'"+d.makeUrl(n.slice(1,-1))+"'"})+");\n":""})+n.replace(/(importScripts\(.*\.js\'\);?)/,"\n"):n}function e(){for(var n=document.getElementsByTagName("script"),e=n.length,t=0;e>t;){if(/communist(\.min)?\.js/.test(n[t].src))return n[t].src;t++}}function t(t){var r,a=n(t.join(""));d.URL=d.URL||window.URL||window.webkitURL;try{r=new Worker(d.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}catch(o){d._noTransferable=!0,r=new Worker(e()),r.postMessage(a)}finally{return r}}function r(n,e){var r=d.deferred(),a=t(["var _self={};\n_self.fun = ",n,";\n	_self.cb=function(data,transfer){\n			!self._noTransferable?self.postMessage(data,transfer):self.postMessage(data);\n			self.close();\n		};\n		_self.result = _self.fun(",JSON.stringify(e),',_self.cb);\n		if(typeof _self.result !== "undefined"){\n			_self.cb(_self.result);\n		}']);return a.onmessage=function(n){r.resolve(n.data)},a.onerror=function(n){n.preventDefault(),r.reject(n.message)},r.promise}function a(n,e,r){var a=new Communist,o=t(["\n	var _db={};\n	_db.__close__=function(){\n		self.close();\n	};\n	var _self={};\n	_db.__fun__ = ",n,';\n	_self.cb=function(data,transfer){\n		!self._noTransferable?self.postMessage(data,transfer):self.postMessage(data);\n	};\n	self.onmessage=function(e){\n		_self.result = _db.__fun__(e.data,_self.cb);\n			if(typeof _self.result !== "undefined"){\n				_self.cb(_self.result);\n		}\n	}']);return o.onmessage=function(n){e(n.data)},o.onerror=r?r:function(){e()},a.data=function(n,e){return d._noTransferable?o.postMessage(n):o.postMessage(n,e),a},a.close=function(){return o.terminate()},a}function o(n){return u({data:n})}function u(n){var e=new Communist,r=0,a=[],o=function(n){"string"!=typeof n&&n.preventDefault&&(n.preventDefault(),n=n.message),a.forEach(function(e){e&&e.reject(n)})};"initialize"in n||(n.initialize=function(){});var u="{",f=function(n){var e=function(e,t){var r=a.length;return a[r]=d.deferred(),d._noTransferable?s.postMessage([r,n,e]):s.postMessage([r,n,e],t),a[r].promise};return e};for(var c in n)0!==r?u+=",":r++,u=u+c+":"+(""+n[c]),e[c]=f(c);u+="}";var s=t(["\n	var _db="+u+';\n	self.onmessage=function(e){\n	var cb=function(data,transfer){\n		!self._noTransferable?self.postMessage([e.data[0],data],transfer):self.postMessage([e.data[0],data]);\n	};\n		var result = _db[e.data[1]](e.data[2],cb);\n			if(typeof result !== "undefined"){\n				cb(result);\n			}\n	}\n	_db.initialize()']);return s.onmessage=function(n){a[n.data[0]].resolve(n.data[1]),a[n.data[0]]=0},s.onerror=o,e._close=function(){return s.terminate(),o("closed"),d.resolve("done")},"close"in e||(e.close=e._close),e}function f(n,e,t,r){function a(n){return function(e,t){return i(n,e,t)}}function o(n){return t?function(e){e.forEach(function(e){i(n,e).then(t)})}:function(e){return d.all(e.map(function(e){return i(n,e)}))}}function f(n){return t?function(e){e.forEach(function(e){i(n,e[0],e[1]).then(t)})}:function(e){return d.all(e.map(function(e){return i(n,e[0],e[1])}))}}function s(n){var e;h?(e=m.shift(),h--,p[n][e[0]](e[1],e[2]).then(function(t){s(n),e[3].resolve(t)},function(t){s(n),e[3].reject(t)})):(v++,_.push(n))}function i(n,e,t){var r,a=d.deferred();return!h&&v?(r=_.pop(),v--,p[r][n](e,t).then(function(n){s(r),a.resolve(n)},function(n){s(r),a.reject(n)})):(h||!v)&&(h=m.push([n,e,t,a])),a.promise}if("dumb"===t)return c(n,e);if("dumb"===r)return c(n,e,t);var l=new Communist;l.batch={},l.batchTransfer={};for(var p=Array(e),v=0,_=[],m=[],h=0;e>v;)p[v]=u(n),_.push(v),v++;n._close=function(){};for(var b in n)l[b]=a(b),l.batch[b]=o(b),l.batchTransfer[b]=f(b);return"close"in l||(l.close=l._close),l}function c(n,e,t){function r(n){return function(e,t){return f(n,e,t)}}function a(n){return t?function(e){e.forEach(function(e){f(n,e).then(t)})}:function(e){return d.all(e.map(function(e){return f(n,e)}))}}function o(n){return t?function(e){e.forEach(function(e){f(n,e[0],e[1]).then(t)})}:function(e){return d.all(e.map(function(e){return f(n,e[0],e[1])}))}}function f(n,t,r){return s[~~(Math.random()*e)][n](t,r)}var c=new Communist;c.batch={},c.batchTransfer={};for(var s=Array(e),i=0,l=[];e>i;)s[i]=u(n),l.push(i),i++;n._close=function(){};for(var p in n)c[p]=r(p),c.batch[p]=a(p),c.batchTransfer[p]=o(p);return"close"in c||(c.close=c._close),c}function s(n,e){var t=new Communist,r="function(dat,cb){ var fun = "+n+';\n		switch(dat[0]){\n			case "data":\n				if(!this._r){\n					this._r = dat[1];\n				}else{\n					this._r = fun(this._r,dat[1]);\n				}\n				break;\n			case "get":\n				return cb(this._r);\n			case "close":\n				cb(this._r);\n				this.__close__();\n				break;\n		}\n	};',o=function(n){e(n)},u=a(r,o);return t.data=function(n,e){return d._noTransferable?u.data(["data",n]):u.data(["data",n],e),t},t.fetch=function(){return u.data(["get"]),t},t.close=function(n){n&&(e=function(){}),u.data(["close"])},t}function i(n){function e(){for(var n=0,e=c.length;e>n&&f>0&&l>0;)f--,c[n].data(i.pop()),n++,l--;return u}function t(){o.close(),c.forEach(function(n){n.close()})}var r,o,u=new Communist,f=0,c=[],i=[],l=n,p=!1,v=!1,_={map:!1,reduce:!1,data:!1},m=function(){return _.map&&_.reduce&&_.data?e():u};return u.map=function(e,r){if(_.map)return u;for(var s=0;n>s;)(function(){var u,s=a(e,function(e){void 0!==typeof e&&o.data(e),f>0?(f--,u=i.pop(),r?s.data(u,[u]):s.data(u)):(l++,l===n&&(_.data=!1,v?t():p&&(p=!1,o.fetch())))});c.push(s)})(),s++;return _.map=!0,m()},u.reduce=function(n){return _.reduce?u:(o=s(n,function(n){r&&(r.resolve(n),r=!1)}),_.reduce=!0,m())},u.data=function(n){return v?void 0:(f+=n.length,i=i.concat(n),_.data=!0,m())},u.fetch=function(e){return r||(r=d.deferred()),n>l&&!e?p=!0:o.fetch(),r.promise},u.close=function(){return r||(r=d.deferred()),n>l?v=!0:t(),r.promise},u}function l(n){function e(){return a.data&&a.map&&a.reduce?r.close():t}var t=new Communist,r=i(n),a={data:!1,map:!1,reduce:!1};return t.map=function(n,t){return a.map=!0,r.map(n,t),e()},t.reduce=function(n){return a.reduce=!0,r.reduce(n),e()},t.data=function(n){return a.data=!0,r.data(n),e()},t}function d(n,e,t){return"number"!=typeof n&&"function"==typeof e?a(n,e,t):"object"!=typeof n||Array.isArray(n)?"number"!=typeof n?e?r(n,e):o(n):"number"==typeof n?e?l(n):i(n):void 0:"number"==typeof e?f(n,e,t):u(n)}(function(n){function e(){var n,u,f={then:function(e,t){return n(e,t)}};return function(){var c=[];n=function(n,t){var r=e();return c.push({d:r,resolve:n,reject:t}),r.promise},u=function(e,s,i){for(var l=0,d=c.length;d>l;l++){var p=c[l],v=p.d,_=p[e];typeof _!==a?v[e](s):r(_,s,v)}n=t(f,s,i),u=o}}(),{resolve:function(n){u("resolve",n,!0)},reject:function(n){u("reject",n,!1)},promise:f}}function t(n,t,o){return function(u,f){var c,s=o?u:f;return typeof s!==a?n:(setTimeout(r.bind(n,s,t,c=e())),c.promise)}}function r(n,e,t){try{var r=n(e);r&&typeof r.then===a?r.then(t.resolve,t.reject):t.resolve(r)}catch(o){t.reject(o)}}var a="function",o=function(){};n.resolve=function(n){var e={};return e.then=t(e,n,!0),e},n.reject=function(n){var e={};return e.then=t(e,n,!1),e},n.deferred=e})(d),d.all=function(n){for(var e=d.deferred(),t=n.length,r=0,a=0,o=Array(t),u=function(n){return function(r){o[n]=r,a++,a===t&&e.resolve(o)}};t>r;)n[r].then(u(r),function(n){e.reject(n)}),r++;return e.promise};var Communist=function(){};d.reducer=s,d.worker=t,d.makeUrl=function(n){var e=document.createElement("link");return e.href=n,e.href},d.ajax=function(n,e,t){var r=t?"request.responseText":"JSON.parse(request.responseText)",a=e?"("+(""+e)+")("+r+",_cb)":r,o='function (url, _cb) {\n		var request = new XMLHttpRequest();\n		request.open("GET", url);\n			request.onreadystatechange = function() {\n				var _resp;\n				if (request.readyState === 4 && request.status === 200) {\n_resp = '+a+';\n					if(typeof _resp!=="undefined"){_cb(_resp);}\n					}\n			};\n			request.onerror=function(e){throw(e);}\n		request.send();\n	}';return d(o,d.makeUrl(n))},window.communist=d}();