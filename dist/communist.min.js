/*! communist 2013-03-19*/
/*!©2013 Calvin Metcalf @license MIT https://github.com/calvinmetcalf/communist */
/*!Includes Promiscuous ©2013 Ruben Verborgh @license MIT https://github.com/RubenVerborgh/promiscuous*/
(function(){"use strict";function e(){return s.deferred()}function n(e){var n,t=e.match(/(importScripts\(.*\);)/);return n=t?t[0].replace(/importScripts\((.*)\);?/,function(e,n){return n?"importScripts("+n.split(",").map(function(e){return'"'+s.makeUrl(e.slice(1,-1))+'"'})+");\n":""})+e.replace(/(importScripts\(.*\);?)/,"\n"):e}function t(e){var t,r=n(e.join(""));if(s.URL=s.URL||window.URL||window.webkitURL||self.URL,window.communist.IEpath){try{t=new Worker(s.URL.createObjectURL(new Blob([r],{type:"text/javascript"})))}catch(u){t=new Worker(window.communist.IEpath),t.postMessage(r)}return t}return new Worker(s.URL.createObjectURL(new Blob([r],{type:"text/javascript"})))}function r(n,r){var u=e(),a=t(["var _self={};\n_self.fun = ",n,";\n	_self.cb=function(data,transfer){\n			self.postMessage(data,transfer);\n			self.close();\n		};\n		_self.result = _self.fun(",JSON.stringify(r),',_self.cb);\n		if(typeof _self.result !== "undefined"){\n			_self.cb(_self.result);\n		}']);return a.onmessage=function(e){u.resolve(e.data)},a.onerror=function(e){e.preventDefault(),u.reject(e.message)},u.promise}function u(e,n,r){var u=new i,a=t(["var _close=function(){self.close();};var _db={};\nvar _self={};\n_self.fun = ",e,';\n		_self.cb=function(data,transfer){\n			self.postMessage(data,transfer);\n		};\n		self.onmessage=function(e){\n		_self.result = _self.fun(e.data,_self.cb);\n			if(typeof _self.result !== "undefined"){\n				_self.cb(_self.result);\n			}\n		}']);return a.onmessage=function(e){n(e.data)},a.onerror=r?r:function(){n()},u.data=function(e,n){return a.postMessage(e,n),u},u.close=function(){return a.terminate()},u}function a(n){var t=new i,r=[],a=function(e){"string"!=typeof e&&e.preventDefault&&(e.preventDefault(),e=e.message),r.forEach(function(n){n&&n.reject(e)})},o="function(data,cb){var _self={};_self.fun = "+n+';\n		_self.numberCB = function(num,d,tran){\n			cb([num,d],tran);\n		};\n		_self.boundCB = _self.numberCB.bind(null,data[0]);\n		_self.result = _self.fun(data[1],_self.boundCB);\n		if(typeof _self.result !== "undefined"){\n			_self.boundCB(_self.result);\n		}\n	}',f=function(e){r[e[0]].resolve(e[1]),r[e[0]]=0},c=u(o,f,a);return t.close=function(){c.close(),a("closed")},t.data=function(n,t){var u=r.length;return r[u]=e(),c.data([u,n],t),r[u].promise},t}function o(e,n){var t=new i,r="function(dat,cb){ var fun = "+e+';\n		switch(dat[0]){\n			case "data":\n				if(!_db._r){\n					_db._r = dat[1];\n				}else{\n					_db._r = fun(_db._r,dat[1]);\n				}\n				break;\n			case "get":\n				return cb(_db._r);\n			case "close":\n				cb(_db._r);\n				_close();\n				break;\n		}\n	};',a=function(e){n(e)},o=u(r,a);return t.data=function(e,n){return o.data(["data",e],n),t},t.fetch=function(){return o.data(["get"]),t},t.close=function(e){e&&(n=function(){}),o.data(["close"])},t}function f(n){function t(){for(var e=0,n=l.length;n>e&&s>0&&p>0;)s--,l[e].data(d.pop()),e++,p--;return c}function r(){f.close(),l.forEach(function(e){e.close()})}var a,f,c=new i,s=0,l=[],d=[],p=n,_=!1,v=!1,m={map:!1,reduce:!1,data:!1},b=function(){return m.map&&m.reduce&&m.data?t():c};return c.map=function(e,t){if(m.map)return c;for(var a=0;n>a;)(function(){var a,o=u(e,function(e){void 0!==typeof e&&f.data(e),s>0?(s--,a=d.pop(),t?o.data(a,[a]):o.data(a)):(p++,p===n&&(m.data=!1,v?r():_&&(_=!1,f.fetch())))});l.push(o)})(),a++;return m.map=!0,b()},c.reduce=function(e){return m.reduce?c:(f=o(e,function(e){a&&(a.resolve(e),a=!1)}),m.reduce=!0,b())},c.data=function(e){return v?void 0:(s+=e.length,d=d.concat(e),m.data=!0,b())},c.fetch=function(t){return a||(a=e()),n>p&&!t?_=!0:f.fetch(),a.promise},c.close=function(){return a||(a=e()),n>p?v=!0:r(),a.promise},c}function c(e){function n(){return u.data&&u.map&&u.reduce?r.close():t}var t=new i,r=f(e),u={data:!1,map:!1,reduce:!1};return t.map=function(e,t){return u.map=!0,r.map(e,t),n()},t.reduce=function(e){return u.reduce=!0,r.reduce(e),n()},t.data=function(e){return u.data=!0,r.data(e),n()},t}function s(e,n,t){return"number"!=typeof e&&"function"==typeof n?u(e,n,t):"number"!=typeof e?n?r(e,n):a(e):"number"==typeof e?n?f(e):c(e):void 0}(function(e){function n(){var e,o,f={then:function(n,t){return e(n,t)}};return function(){var c=[];e=function(e,t){var r=n();return c.push({d:r,resolve:e,reject:t}),r.promise},o=function(n,s,i){for(var l=0,d=c.length;d>l;l++){var p=c[l],_=p.d,v=p[n];typeof v!==u?_[n](s):r(v,s,_)}e=t(f,s,i),o=a}}(),{resolve:function(e){o("resolve",e,!0)},reject:function(e){o("reject",e,!1)},promise:f}}function t(e,t,a){return function(o,f){var c,s=a?o:f;return typeof s!==u?e:(setTimeout(r.bind(e,s,t,c=n())),c.promise)}}function r(e,n,t){try{var r=e(n);r&&typeof r.then===u?r.then(t.resolve,t.reject):t.resolve(r)}catch(a){t.reject(a)}}var u="function",a=function(){};e.resolve=function(e){var n={};return n.then=t(n,e,!0),n},e.reject=function(e){var n={};return n.then=t(n,e,!1),n},e.deferred=n})(s);var i=function(){};s.reducer=o,s.worker=t,s.makeUrl=function(e){var n=document.createElement("link");return n.href=e,n.href},s.ajax=function(e,n,t){var r=t?"request.responseText":"JSON.parse(request.responseText)",u=n?"("+(""+n)+")("+r+",_cb)":r,a='function (url, _cb) {\n		var request = new XMLHttpRequest();\n		request.open("GET", url);\n			request.onreadystatechange = function() {\n				var _resp;\n				if (request.readyState === 4 && request.status === 200) {\n_resp = '+u+';\n					if(typeof _resp!=="undefined"){_cb(_resp);}\n					}\n			};\n		request.send();\n	}';return s(a,s.makeUrl(e))},window.communist=s})();