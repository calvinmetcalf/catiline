/*! catiline 2.8.4 2013-09-21*/
/*!(c)2013 Calvin Metcalf @license MIT https://github.com/calvinmetcalf/catiline */
/*!Includes Promiscuous (c)2013 Ruben Verborgh @license MIT https://github.com/RubenVerborgh/promiscuous*/
/*!Includes Material from setImmediate Copyright (c) 2012 Barnesandnoble.com, llc, Donavon West, and Domenic Denicola @license MIT https://github.com/NobleJS/setImmediate */
"undefined"==typeof document?(self._noTransferable=!0,self.onmessage=function(e){eval(e.data)}):!function(a){"use strict";function b(){var a,b=0,c=u;for(u=[];a=c[b++];)a()}function Deferred(){function Promise(){this.then=function(b,c){return a(b,c)}}var a=function(f,g,h){if(f!==a){var i=c();return a.queue.push({deferred:i,resolve:f,reject:g}),i.promise}for(var j=g?"resolve":"reject",k=0,l=a.queue.length;l>k;k++){var m=a.queue[k],n=m.deferred,o=m[j];typeof o!==v?n[j](h):e(o,h,n)}a=d(b,h,g)},b=new Promise;this.promise=b,a.queue=[],this.resolve=function(b){a.queue&&a(a,!0,b)},this.fulfill=this.resolve,this.reject=function(b){a.queue&&a(a,!1,b)}}function c(){return new Deferred}function d(a,b,d){return function(f,g){var h=d?f:g;if(typeof h!==v)return a;var i=c();return e(h,b,i),i.promise}}function e(a,b,c){n.nextTick(function(){try{var d=a(b);d&&typeof d.then===v?d.then(c.resolve,c.reject):c.resolve(d)}catch(e){c.reject(e)}})}function f(a){for(var b=a,c=!0,d={},e=function(a,b){b&&"importScripts("+b.split(",").forEach(function(a){d[n.makeUrl(a.match(/\s*[\'\"](\S*)[\'\"]\s*/)[1])]=!0})+");\n"};c;)c=b.match(/(importScripts\(.*?\);?)/),b=b.replace(/(importScripts\(\s*(?:[\'\"].*?[\'\"])?\s*\);?)/,"\n"),c&&c[0].replace(/importScripts\(\s*([\'\"].*?[\'\"])?\s*\);?/g,e);return d=Object.keys(d),[d,b]}function g(a){var b=f(a),c=b[0],d=b[1];return c.length>0?"importScripts('"+c.join("','")+"');\n"+d:d}function h(a){var b=f(a),c=b[0],d=b[1];return c.length>0?"importScripts('"+c.join("','")+"');eval(__scripts__);\n"+d:d}function i(){if("undefined"!=typeof SHIM_WORKER_PATH)return SHIM_WORKER_PATH;if("SHIM_WORKER_PATH"in n)return n.SHIM_WORKER_PATH;for(var a=document.getElementsByTagName("script"),b=a.length,c=0;b>c;){if(/catiline(\.min)?\.js/.test(a[c].src))return a[c].src;c++}}function j(a,b){var c=a.createElement("script");"undefined"!=typeof c.text?c.text=b:c.innerHTML=b,"complete"===a.readyState?a.documentElement.appendChild(c):a.onreadystatechange=function(){"complete"===a.readyState&&a.documentElement.appendChild(c)}}function k(a,b){var c=document.createElement("iframe");c.style.display="none",document.body.appendChild(c);var d=c.contentWindow,e=d.document,f=["try{ ","var __scripts__='';function importScripts(scripts){","	if(Array.isArray(scripts)&&scripts.length>0){","		scripts.forEach(function(url){","			var ajax = new XMLHttpRequest();","			ajax.open('GET',url,false);","			ajax.send();__scripts__+=ajax.responseText;","			__scripts__+='\\n;';","		});","	}","};",a,"}catch(e){","	window.parent.postMessage(['"+b+"','error'],'*')","}"].join("\n");return j(e,f),c}function l(a,b){var c=n.deferred();return"complete"===document.readyState?c.resolve(k(a,b)):window.addEventListener("load",function(){c.resolve(k(a,b))},!1),c.promise}function m(a){n._noTransferable=!0;var b=new Worker(i());return b.postMessage(a),b}function n(a,b,c){return 1===arguments.length||!b||1>=b?new n.Worker(a):new n.Queue(a,b,c)}function o(b){var c=a.cw;b.noConflict=function(d){a.cw=c,d&&(a[d]=b)},a.catiline=b,a.cw=b,"communist"in a||(a.communist=b)}var p,q=a.MutationObserver||a.WebKitMutationObserver;if("function"==typeof setImmediate)p=setImmediate.bind(a,b);else if(q){var r=new q(b),s=document.createElement("div");r.observe(s,{attributes:!0}),addEventListener("unload",function(){r.disconnect(),r=null},!1),p=function(){s.setAttribute("drainQueue","drainQueue")}}else{var t="com.catiline.setImmediate"+Math.random();addEventListener("message",function(a){a.source===window&&a.data===t&&b()},!1),p=function(){postMessage(t,"*")}}var u=[];n.nextTick=function(a){1===u.push(a)&&p()};var v="function";n.deferred=c,n.resolve=function(a){var b={};return b.then=d(b,a,!0),b},n.reject=function(a){var b={};return b.then=d(b,a,!1),b},n.all=function(a){var b=c(),d=a.length,e=0,f=[],g=function(a){return function(c){f[a]=c,e++,e===d&&b.resolve(f)}};return a.forEach(function(a,c){a.then(g(c),function(a){b.reject(a)})}),b.promise},n._hasWorker="undefined"!=typeof Worker&&"undefined"==typeof fakeLegacy,n.URL=window.URL||window.webkitURL,n._noTransferable=!n.URL,n.makeIWorker=function(a,b){var c=h(a.join("")),d={onmessage:function(){}},e=l(c,b);return window.addEventListener("message",function(a){a.data.slice&&a.data.slice(0,b.length)===b&&d.onmessage({data:JSON.parse(a.data.slice(b.length))})}),d.postMessage=function(a){e.then(function(b){b.contentWindow.postMessage(JSON.stringify(a),"*")})},d.terminate=function(){e.then(function(a){document.body.removeChild(a)})},d},n.makeWorker=function(a,b){if(!n._hasWorker)return n.makeIWorker(a,b);var c,d=g(a.join(""));if(n._noTransferable)return m(d);try{c=new Worker(n.URL.createObjectURL(new Blob([d],{type:"text/javascript"})))}catch(e){try{c=m(d)}catch(f){c=n.makeIWorker(a,b)}}finally{return c}},n.makeUrl=function(a){var b=document.createElement("link");return b.href=a,b.href},n.Worker=function(a){function b(a,c){return a.indexOf(" ")>0?(a.split(" ").forEach(function(a){b(a,c)}),e):a in d?(d[a].forEach(function(a){a(c)}),e):e}"function"==typeof a&&(a={data:a});var c="com.catilinejs."+(n._hasWorker?"iframe":"worker")+Math.random(),d={},e=this;e.on=function(a,b,c){return c=c||e,a.indexOf(" ")>0?(a.split(" ").map(function(a){return e.on(a,b,c)},this),e):(a in d||(d[a]=[]),d[a].push(function(a){b.call(c,a)}),e)},e.fire=function(a,b,c){return n._noTransferable?l.postMessage([[a],b]):l.postMessage([[a],b],c),e},e.off=function(a,b){return a.indexOf(" ")>0?(a.split(" ").map(function(a){return e.off(a,b)}),e):a in d?(b?d[a].indexOf(b)>-1&&(d[a].length>1?delete d[a]:d[a].splice(d[a].indexOf(b),1)):delete d[a],e):e};var f=[],g=function(a){"string"!=typeof a&&"preventDefault"in a&&(a.preventDefault(),a=a.message),f.forEach(function(b){b&&b.reject(a)})};a.__codeWord__='"'+c+'"',"initialize"in a||(a.initialize="init"in a?a.init:function(){});var h="{\n	",i=function(a){var b=function(b,d){var e=f.length;return f[e]=n.deferred(),n._noTransferable?l.postMessage([[c,e],a,b]):l.postMessage([[c,e],a,b],d),f[e].promise};return b},j=0;for(var k in a)0!==j?h+=",\n	":j++,h=h+k+":"+a[k].toString(),e[k]=i(k);h+="}";var l=n.makeWorker(['"use strict";function _fire(e,n){return e.indexOf(" ")>0?(e.split(" ").forEach(function(e){_fire(e,n)}),void 0):(e in listeners&&listeners[e].forEach(function(e){e(n)}),void 0)}function makeConsole(e){return function(){for(var n=arguments.length,s=[],i=0;n>i;)s.push(arguments[i]),i++;_db.fire("console",[e,s])}}var _db=',h,',listeners={},__iFrame__="undefined"!=typeof document,__self__={onmessage:function(e){return _fire("messege",e.data[1]),e.data[0][0]===_db.__codeWord__?regMsg(e):(_fire(e.data[0][0],e.data[1]),void 0)}};__iFrame__?window.onmessage=function(e){"string"==typeof e.data&&(e={data:JSON.parse(e.data)}),__self__.onmessage(e)}:self.onmessage=__self__.onmessage,__self__.postMessage=function(e,n){if(self._noTransferable||__iFrame__)if(__iFrame__){var s=_db.__codeWord__+JSON.stringify(e);window.parent.postMessage(s,"*")}else self._noTransferable&&self.postMessage(e);else self.postMessage(e,n)},_db.on=function(e,n,s){return e.indexOf(" ")>0?e.split(" ").map(function(e){return _db.on(e,n,s)},_db):(s=s||_db,e in listeners||(listeners[e]=[]),listeners[e].push(function(e){n.call(s,e,_db)}),void 0)},_db.fire=function(e,n,s){__self__.postMessage([[e],n],s)},_db.off=function(e,n){return e.indexOf(" ")>0?e.split(" ").map(function(e){return _db.off(e,n)}):(e in listeners&&(n?listeners[e].indexOf(n)>-1&&(listeners[e].length>1?delete listeners[e]:listeners[e].splice(listeners[e].indexOf(n),1)):delete listeners[e]),void 0)};var console={};["log","debug","error","info","warn","time","timeEnd"].forEach(function(e){console[e]=makeConsole(e)});var regMsg=function(e){var n,s=function(n,s){__self__.postMessage([e.data[0],n],s)};if(__iFrame__)try{n=_db[e.data[1]](e.data[2],s,_db)}catch(e){_db.fire("error",JSON.stringify(e))}else n=_db[e.data[1]](e.data[2],s,_db);"undefined"!=typeof n&&s(n)};_db.initialize(_db);'],c);l.onmessage=function(a){b("message",a.data[1]),a.data[0][0]===c?(f[a.data[0][1]].resolve(a.data[1]),f[a.data[0][1]]=0):b(a.data[0][0],a.data[1])},e.on("error",g),l.onerror=function(a){b("error",a)},e.on("console",function(a){console[a[0]].apply(console,a[1])}),e._close=function(){return l.terminate(),g("closed"),n.resolve()},"close"in e||(e.close=e._close)},n.worker=function(a){return new n.Worker(a)},n.Queue=function(a,b,c){function d(a){a=a||"canceled",r=0;var b=q;return q=[],b.forEach(function(b){b[3].reject(a)}),l}function e(a){return function(b,c){return k(a,b,c)}}function f(a){return function(b){return n.all(b.map(function(b){return k(a,b)}))}}function g(a){return function(b){var c=this;return n.all(b.map(function(b){return k(a,b).then(c.__cb__)}))}}function h(a){return function(b){return n.all(b.map(function(b){return k(a,b[0],b[1])}))}}function i(a){return function(b){var c=this;return n.all(b.map(function(b){return k(a,b[0],b[1]).then(c.__cb__)}))}}function j(a){if(r){var b=q.shift();r--,m[a][b[0]](b[1],b[2]).then(function(c){j(a),b[3].resolve(c)},function(c){j(a),b[3].reject(c)})}else o++,p.push(a)}function k(a,d,e){var f=n.deferred();if(c)return f.promise.cancel=function(a){return f.reject(a)},m[~~(Math.random()*b)][a](d,e).then(function(a){return f.resolve(a)},function(a){return f.reject(a)}),f.promise;if(!r&&o){var g=p.pop();o--,f.promise.cancel=function(a){return f.reject(a)},m[g][a](d,e).then(function(a){j(g),f.resolve(a)},function(a){j(g),f.reject(a)})}else if(r||!o){var h=[a,d,e,f];f.promise.cancel=function(a){var b=q.indexOf(h);return b>-1&&(q.splice(b,1),r--),f.reject(a)},r=q.push(h)}return f.promise}var l=this;l.__batchcb__={},l.__batchtcb__={},l.batch=function(a){return"function"==typeof a?(l.__batchcb__.__cb__=a,l.__batchcb__):d(a)},l.batchTransfer=function(a){return"function"==typeof a?(l.__batchtcb__.__cb__=a,l.__batchtcb__):d(a)};for(var m=[],o=0,p=[],q=[],r=0;b>o;)m[o]=new n.Worker(a),p.push(o),o++;l.on=function(a,b,c){return m.forEach(function(d){d.on(a,b,c)}),l},l.off=function(a,b,c){return m.forEach(function(d){d.off(a,b,c)}),l};var s=function(a,b){return m.forEach(function(c){c.fire(a,b)}),l};l.fire=function(a,c){return m[~~(Math.random()*b)].fire(a,c),l},l.batch.fire=s,l.batchTransfer.fire=s;for(var t in a)l[t]=e(t),l.batch[t]=f(t),l.__batchcb__[t]=g(t),l.batchTransfer[t]=h(t),l.__batchtcb__[t]=i(t);l._close=function(){return n.all(m.map(function(a){return a._close()}))},"close"in l||(l.close=l._close)},n.queue=function(a,b,c){return new n.Queue(a,b,c)},n.setImmediate=n.nextTick,"function"==typeof define?define(function(a){return n.SHIM_WORKER_PATH=a.toUrl("./catiline.js"),n}):"undefined"!=typeof module&&"exports"in module?module.exports=n:o(n),n.version="2.8.4"}(this);