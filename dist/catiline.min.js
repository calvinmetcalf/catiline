/*! catiline 2.6.0 2013-08-17*/
/*!(c)2013 Calvin Metcalf @license MIT https://github.com/calvinmetcalf/catiline */
/*!Includes Promiscuous (c)2013 Ruben Verborgh @license MIT https://github.com/RubenVerborgh/promiscuous*/
/*!Includes Material from setImmediate Copyright (c) 2012 Barnesandnoble.com, llc, Donavon West, and Domenic Denicola @license MIT https://github.com/NobleJS/setImmediate */
"undefined"==typeof document?(self._noTransferable=!0,self.onmessage=function(e){eval(e.data)}):function(global){"use strict";function regexImports(e){for(var n=e,s=!0,t={},i=function(e,n){n&&"importScripts("+n.split(",").forEach(function(e){t[catiline.makeUrl(e.match(/\s*[\'\"](\S*)[\'\"]\s*/)[1])]=!0})+");\n"};s;)s=n.match(/(importScripts\(.*?\);?)/),n=n.replace(/(importScripts\(\s*(?:[\'\"].*?[\'\"])?\s*\);?)/,"\n"),s&&s[0].replace(/importScripts\(\s*([\'\"].*?[\'\"])?\s*\);?/g,i);return t=Object.keys(t),[t,n]}function moveImports(e){var n=regexImports(e),s=n[0],t=n[1];return s.length>0?"importScripts('"+s.join("','")+"');\n"+t:t}function moveIimports(e){var n=regexImports(e),s=n[0],t=n[1];return s.length>0?"importScripts('"+s.join("','")+"');eval(__scripts__);\n"+t:t}function getPath(){if("undefined"!=typeof SHIM_WORKER_PATH)return SHIM_WORKER_PATH;if("SHIM_WORKER_PATH"in catiline)return catiline.SHIM_WORKER_PATH;for(var e=document.getElementsByTagName("script"),n=e.length,s=0;n>s;){if(/catiline(\.min)?\.js/.test(e[s].src))return e[s].src;s++}}function appendScript(e,n){var s=e.createElement("script");"undefined"!=typeof s.text?s.text=n:s.innerHTML=n,"complete"===e.readyState?e.documentElement.appendChild(s):e.onreadystatechange=function(){"complete"===e.readyState&&e.documentElement.appendChild(s)}}function actualMakeI(e,n){var s=document.createElement("iframe");s.style.display="none",document.body.appendChild(s);var t=s.contentWindow,i=t.document,_=["try{ ","var __scripts__='';function importScripts(scripts){","	if(Array.isArray(scripts)&&scripts.length>0){","		scripts.forEach(function(url){","			var ajax = new XMLHttpRequest();","			ajax.open('GET',url,false);","			ajax.send();__scripts__+=ajax.responseText;","			__scripts__+='\\n;';","		});","	}","};",e,"}catch(e){","	window.parent.postMessage(['"+n+"','error'],'*')","}"].join("\n");return appendScript(i,_),s}function makeIframe(e,n){var s=catiline.deferred();return"complete"===document.readyState?s.resolve(actualMakeI(e,n)):window.addEventListener("load",function(){s.resolve(actualMakeI(e,n))},!1),s.promise}function makeFallbackWorker(e){catiline._noTransferable=!0;var n=new Worker(getPath());return n.postMessage(e),n}function catiline(e,n,s){return 1===arguments.length||!n||1>=n?new catiline.Worker(e):new catiline.Queue(e,n,s)}function initBrowser(e){var n=global.cw;e.noConflict=function(s){global.cw=n,s&&(global[s]=e)},global.catiline=e,global.cw=e,"communist"in global||(global.communist=e)}!function(attachTo,global){function isStringAndStartsWith(e,n){return"string"==typeof e&&e.substring(0,n.length)===n}function onGlobalMessage(e){if(e.source===global&&isStringAndStartsWith(e.data,MESSAGE_PREFIX)){var n=e.data.substring(MESSAGE_PREFIX.length);tasks.runIfPresent(n)}}if(global.setImmediate)return attachTo.setImmediate=global.setImmediate,void 0;var tasks=function(){function Task(e,n){this.handler=e,this.args=n}Task.prototype.run=function(){if("function"==typeof this.handler)this.handler.apply(void 0,this.args);else{var scriptSource=""+this.handler;eval(scriptSource)}};var nextHandle=1,tasksByHandle={},currentlyRunningATask=!1;return{addFromSetImmediateArguments:function(e){var n=e[0],s=Array.prototype.slice.call(e,1),t=new Task(n,s),i=nextHandle++;return tasksByHandle[i]=t,i},runIfPresent:function(e){if(currentlyRunningATask)global.setTimeout(function(){tasks.runIfPresent(e)},0);else{var n=tasksByHandle[e];if(n){currentlyRunningATask=!0;try{n.run()}finally{delete tasksByHandle[e],currentlyRunningATask=!1}}}},remove:function(e){delete tasksByHandle[e]}}}(),MESSAGE_PREFIX="com.catilinejs.setImmediate"+Math.random();global.addEventListener?global.addEventListener("message",onGlobalMessage,!1):global.attachEvent("onmessage",onGlobalMessage),attachTo.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return global.postMessage(MESSAGE_PREFIX+e,"*"),e}}(catiline,global),function(e,n){function Deferred(){function Promise(){this.then=function(n,s){return e(n,s)}}var e=function(r,o,a){var f;if(r!==e)return f=s(),e.queue.push({deferred:f,resolve:r,reject:o}),f.promise;for(var d,l,u,c=o?"resolve":"reject",g=0,b=e.queue.length;b>g;g++)d=e.queue[g],l=d.deferred,u=d[c],typeof u!==_?l[c](a):i(u,a,l);e=t(n,a,o)},n=new Promise;this.promise=n,e.queue=[],this.resolve=function(n){e.queue&&e(e,!0,n)},this.fulfill=this.resolve,this.reject=function(n){e.queue&&e(e,!1,n)}}function s(){return new Deferred}function t(e,n,t){return function(r,o){var a,f=t?r:o;return typeof f!==_?e:(i(f,n,a=s()),a.promise)}}function i(e,s,t){n(function(){var n;try{n=e(s),n&&typeof n.then===_?n.then(t.resolve,t.reject):t.resolve(n)}catch(i){t.reject(i)}})}var _="function";e.resolve=function(e){var n={};return n.then=t(n,e,!0),n},e.reject=function(e){var n={};return n.then=t(n,e,!1),n},e.deferred=s,e.all=function(n){var s=e.deferred(),t=n.length,i=0,_=[],r=function(e){return function(n){_[e]=n,i++,i===t&&s.resolve(_)}};return n.forEach(function(e,n){e.then(r(n),function(e){s.reject(e)})}),s.promise}}(catiline,catiline.setImmediate),catiline._hasWorker="undefined"!=typeof Worker&&"undefined"==typeof fakeLegacy,catiline.URL=window.URL||window.webkitURL,catiline._noTransferable=!catiline.URL,catiline.makeIWorker=function(e,n){var s=moveIimports(e.join("")),t={onmessage:function(){}},i=makeIframe(s,n);return window.addEventListener("message",function(e){"string"==typeof e.data&&e.data.length>n.length&&e.data.slice(0,n.length)===n&&t.onmessage({data:JSON.parse(e.data.slice(n.length))})}),t.postMessage=function(e){i.then(function(n){n.contentWindow.postMessage(JSON.stringify(e),"*")})},t.terminate=function(){i.then(function(e){document.body.removeChild(e)})},t},catiline.makeWorker=function(e,n){if(!catiline._hasWorker)return catiline.makeIWorker(e,n);var s,t=moveImports(e.join(""));if(catiline._noTransferable)return makeFallbackWorker(t);try{s=new Worker(catiline.URL.createObjectURL(new Blob([t],{type:"text/javascript"})))}catch(i){try{s=makeFallbackWorker(t)}catch(_){s=catiline.makeIWorker(e,n)}}finally{return s}},catiline.makeUrl=function(e){var n=document.createElement("link");return n.href=e,n.href},catiline.Worker=function(e){function n(e,s){return e.indexOf(" ")>0?(e.split(" ").forEach(function(e){n(e,s)}),i):e in t?(t[e].forEach(function(e){e(s)}),i):i}"function"==typeof e&&(e={data:e});var s="com.catilinejs."+(catiline._hasWorker?"iframe":"worker")+Math.random(),t={},i=this;i.on=function(e,n,s){return s=s||i,e.indexOf(" ")>0?(e.split(" ").map(function(e){return i.on(e,n,s)},this),i):(e in t||(t[e]=[]),t[e].push(function(e){n.call(s,e)}),i)},i.fire=function(e,n,s){return catiline._noTransferable?l.postMessage([[e],n]):l.postMessage([[e],n],s),i},i.off=function(e,n){return e.indexOf(" ")>0?(e.split(" ").map(function(e){return i.off(e,n)}),i):e in t?(n?t[e].indexOf(n)>-1&&(t[e].length>1?delete t[e]:t[e].splice(t[e].indexOf(n),1)):delete t[e],i):i};var _=0,r=[],o=function(e){"string"!=typeof e&&"preventDefault"in e&&(e.preventDefault(),e=e.message),r.forEach(function(n){n&&n.reject(e)})};e.__codeWord__='"'+s+'"',"initialize"in e||(e.initialize="init"in e?e.init:function(){});var a="{\n	",f=function(e){var n=function(n,t){var i=r.length;return r[i]=catiline.deferred(),catiline._noTransferable?l.postMessage([[s,i],e,n]):l.postMessage([[s,i],e,n],t),r[i].promise};return n};for(var d in e)0!==_?a+=",\n	":_++,a=a+d+":"+e[d].toString(),i[d]=f(d);a+="}";var l=catiline.makeWorker(['"use strict";function _fire(e,n){return e.indexOf(" ")>0?(e.split(" ").forEach(function(e){_fire(e,n)}),void 0):(e in listeners&&listeners[e].forEach(function(e){e(n)}),void 0)}function makeConsole(e){return function(){for(var n=arguments.length,s=[],t=0;n>t;)s.push(arguments[t]),t++;_db.fire("console",[e,s])}}var _db=',a,',listeners={},__iFrame__="undefined"!=typeof document,__self__={onmessage:function(e){return _fire("messege",e.data[1]),e.data[0][0]===_db.__codeWord__?regMsg(e):(_fire(e.data[0][0],e.data[1]),void 0)}};__iFrame__?window.onmessage=function(e){"string"==typeof e.data&&(e={data:JSON.parse(e.data)}),__self__.onmessage(e)}:self.onmessage=__self__.onmessage,__self__.postMessage=function(e,n){var s;self._noTransferable||__iFrame__?__iFrame__?(s=_db.__codeWord__+JSON.stringify(e),window.parent.postMessage(s,"*")):self._noTransferable&&self.postMessage(e):self.postMessage(e,n)},_db.on=function(e,n,s){return e.indexOf(" ")>0?e.split(" ").map(function(e){return _db.on(e,n,s)},_db):(s=s||_db,e in listeners||(listeners[e]=[]),listeners[e].push(function(e){n.call(s,e,_db)}),void 0)},_db.fire=function(e,n,s){__self__.postMessage([[e],n],s)},_db.off=function(e,n){return e.indexOf(" ")>0?e.split(" ").map(function(e){return _db.off(e,n)}):(e in listeners&&(n?listeners[e].indexOf(n)>-1&&(listeners[e].length>1?delete listeners[e]:listeners[e].splice(listeners[e].indexOf(n),1)):delete listeners[e]),void 0)};var console={};["log","debug","error","info","warn","time","timeEnd"].forEach(function(e){console[e]=makeConsole(e)});var regMsg=function(e){var n,s=function(n,s){__self__.postMessage([e.data[0],n],s)};if(__iFrame__)try{n=_db[e.data[1]](e.data[2],s,_db)}catch(e){_db.fire("error",JSON.stringify(e))}else n=_db[e.data[1]](e.data[2],s,_db);"undefined"!=typeof n&&s(n)};_db.initialize(_db);'],s);l.onmessage=function(e){n("message",e.data[1]),e.data[0][0]===s?(r[e.data[0][1]].resolve(e.data[1]),r[e.data[0][1]]=0):n(e.data[0][0],e.data[1])},i.on("error",o),l.onerror=function(e){n("error",e)},i.on("console",function(e){console[e[0]].apply(console,e[1])}),i._close=function(){return l.terminate(),o("closed"),catiline.resolve()},"close"in i||(i.close=i._close)},catiline.worker=function(e){return new catiline.Worker(e)},catiline.Queue=function(e,n,s){function t(e){e=e||"canceled",m=0;var n=b;return b=[],n.forEach(function(n){n[3].reject(e)}),l}function i(e){return function(n,s){return d(e,n,s)}}function _(e){return function(n){return catiline.all(n.map(function(n){return d(e,n)}))}}function r(e){return function(n){var s=this;return catiline.all(n.map(function(n){return d(e,n).then(s.__cb__)}))}}function o(e){return function(n){return catiline.all(n.map(function(n){return d(e,n[0],n[1])}))}}function a(e){return function(n){var s=this;return catiline.all(n.map(function(n){return d(e,n[0],n[1]).then(s.__cb__)}))}}function f(e){var n;m?(n=b.shift(),m--,u[e][n[0]](n[1],n[2]).then(function(s){f(e),n[3].resolve(s)},function(s){f(e),n[3].reject(s)})):(c++,g.push(e))}function d(e,t,i){if(s)return u[~~(Math.random()*n)][e](t,i);var _,r=catiline.deferred();return!m&&c?(_=g.pop(),c--,u[_][e](t,i).then(function(e){f(_),r.resolve(e)},function(e){f(_),r.reject(e)})):(m||!c)&&(m=b.push([e,t,i,r])),r.promise}var l=this;l.__batchcb__={},l.__batchtcb__={},l.batch=function(e){return"function"==typeof e?(l.__batchcb__.__cb__=e,l.__batchcb__):t(e)},l.batchTransfer=function(e){return"function"==typeof e?(l.__batchtcb__.__cb__=e,l.__batchtcb__):t(e)};for(var u=new Array(n),c=0,g=[],b=[],m=0;n>c;)u[c]=new catiline.Worker(e),g.push(c),c++;l.on=function(e,n,s){return u.forEach(function(t){t.on(e,n,s)}),l},l.off=function(e,n,s){return u.forEach(function(t){t.off(e,n,s)}),l};var p=function(e,n){return u.forEach(function(s){s.fire(e,n)}),l};l.fire=function(e,s){return u[~~(Math.random()*n)].fire(e,s),l},l.batch.fire=p,l.batchTransfer.fire=p;for(var v in e)l[v]=i(v),l.batch[v]=_(v),l.__batchcb__[v]=r(v),l.batchTransfer[v]=o(v),l.__batchtcb__[v]=a(v);l._close=function(){return catiline.all(u.map(function(e){return e._close()}))},"close"in l||(l.close=l._close)},catiline.queue=function(e,n,s){return new catiline.Queue(e,n,s)},"function"==typeof define?define(function(e){return catiline.SHIM_WORKER_PATH=e.toUrl("./catiline.js"),catiline}):"undefined"!=typeof module&&"exports"in module?module.exports=catiline:initBrowser(catiline),catiline.version="2.6.0"}(this);